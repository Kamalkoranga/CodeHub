<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Codehub Stream</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' href="{{url_for('static', filename='css/group.css')}}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/5.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/2.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/4.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
</head>

<body>
    <a href="{{url_for('dashboard', username=current_user.username)}}">
        <img src="{{url_for('static', filename='images/3.png')}}" alt="">
    </a>

    <button id="join-btn">Join Stream</button>

    <div id="stream-wrapper">
        <div id="video-streams"></div>

        <div id="stream-controls">
            <button id="leave-btn">Leave Stream</button>
            <button id="mic-btn">Mic On</button>
            <button id="camera-btn">Camera on</button>
        </div>
    </div>

    <div class="chat">
        <div id="messages" ></div>
        <p id="username" style="display: none; text-align:right;">{{current_user.username|capitalize}}</p>
        <input type="text" id="message" placeholder="Message" required>
        <button id="sendBtn">Send</button>

    </div>

    <script src="{{url_for('static', filename='js/AgoraRTC_N-4.7.3.js')}}"></script>
    <script src="{{url_for('static', filename='js/group.js')}}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.min.js"
        integrity="sha512-mHO4BJ0ELk7Pb1AzhTi3zvUeRgq3RXVOu9tTRfnA6qOxGK4pG2u57DJYolI4KrEnnLTcH9/J5wNOozRTDaybXg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            console.log(document.getElementById('username').textContent)
            var socket = io.connect("http://localhost:5000"); // Change Address to ipv4 address
            socket.on('connect', function () {
                socket.send("User connected!");
            });
    
            socket.on('message', function (data) {
                $('#messages').append($('<p>').text(data));
            });
    
            $('#sendBtn').on('click', function () {
                socket.send(document.getElementById('username').textContent + ': ' + $('#message').val());
                $('#message').val('');
            });
        })
    </script>
</body>

</html>